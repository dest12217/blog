__NUXT_JSONP__("/", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,$,aa,ab,ac,ad,ae,af,ag,ah,ai,aj,ak,al,am,an,ao,ap,aq,ar,as,at,au,av,aw,ax,ay,az,aA,aB,aC,aD,aE,aF,aG,aH,aI,aJ,aK,aL,aM,aN,aO,aP,aQ,aR,aS,aT,aU,aV,aW,aX,aY,aZ,a_,a$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz){return {data:[{articles:[{slug:"20201225",title:"\u003Cinput type=\"file\"\u003EをJavaScriptで扱うときに気をつけること",timestamp:"2020\u002F12\u002F25",tags:[Z,aH],toc:[{id:aI,depth:D,text:"1. \u003Cinput type=\"file\"\u003Eのvalueは、画像データではない"},{id:aJ,depth:D,text:"2. \u003Cinput type=\"file\"\u003Eで取得した画像データは、置き換えできない"},{id:_,depth:D,text:_},{id:E,depth:D,text:E}],body:{type:M,children:[{type:b,tag:f,props:{},children:[{type:a,value:"この記事は"},{type:b,tag:j,props:{href:"https:\u002F\u002Fqiita.com\u002Fadvent-calendar\u002F2020\u002Fjavascript",rel:[p,q,r],target:s},children:[{type:a,value:"JavaScript Advent Calendar 2020"}]},{type:a,value:"の25日目になります。"}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"レビューサイトを始めとする「ユーザーが画像ファイルをそれぞれがアップロードして投稿するウェブサイト」を作るとき、必ず用いられるのが"},{type:b,tag:d,props:{},children:[{type:a,value:z}]},{type:a,value:"によるアップロードです。"}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"一般的にファイルのアップロードといえば、PHPやSQLといったバックエンド技術が主役のように捉えられがちです。"},{type:b,tag:i,props:{},children:[]},{type:a,value:"\nしかし、取得した画像ファイルを用いたサムネイルの生成や画像ファイルの軽量化など、JavaScriptの出番も少なくありません。 "}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"実際に"},{type:b,tag:d,props:{},children:[{type:a,value:z}]},{type:a,value:"を取り扱い、いくつかハマりやすいと感じたポイントがあったため、この場を借りてまとめていきます。"}]},{type:a,value:e},{type:b,tag:F,props:{id:aI},children:[{type:b,tag:j,props:{href:"#1-input-typefile%E3%81%AEvalue%E3%81%AF%E3%80%81%E7%94%BB%E5%83%8F%E3%83%87%E3%83%BC%E3%82%BF%E3%81%A7%E3%81%AF%E3%81%AA%E3%81%84",ariaHidden:A,tabIndex:G},children:[{type:b,tag:c,props:{className:[H,I]},children:[]}]},{type:a,value:"1. "},{type:b,tag:d,props:{},children:[{type:a,value:z}]},{type:a,value:an},{type:b,tag:d,props:{},children:[{type:a,value:w}]},{type:a,value:"は、画像データではない"}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:b,tag:d,props:{},children:[{type:a,value:aK}]},{type:a,value:"要素は、入力されたテキストをステータスを"},{type:b,tag:d,props:{},children:[{type:a,value:w}]},{type:a,value:"の中に格納し、保持します。"},{type:b,tag:i,props:{},children:[]},{type:a,value:e},{type:b,tag:d,props:{},children:[{type:a,value:z}]},{type:a,value:"を例外ではなく、"},{type:b,tag:d,props:{},children:[{type:a,value:w}]},{type:a,value:"で値を受け取り、"},{type:b,tag:d,props:{},children:[{type:a,value:w}]},{type:a,value:"を空にすることでデータを削除することができます。\nしかし、その"},{type:b,tag:d,props:{},children:[{type:a,value:w}]},{type:a,value:"内部を"},{type:b,tag:d,props:{},children:[{type:a,value:"console.log"}]},{type:a,value:"で確認すると、値は画像データではありませんでした。"}]},{type:a,value:e},{type:b,tag:n,props:{className:[t]},children:[{type:b,tag:u,props:{},children:[{type:b,tag:d,props:{className:[v,ao]},children:[{type:a,value:"C:"},{type:b,tag:c,props:{className:[aL]},children:[{type:a,value:"\\f"}]},{type:a,value:"akepath"},{type:b,tag:c,props:{className:[aL]},children:[{type:a,value:"\\i"}]},{type:a,value:"mage.jpg\n"}]}]}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:b,tag:d,props:{},children:[{type:a,value:z}]},{type:a,value:an},{type:b,tag:d,props:{},children:[{type:a,value:w}]},{type:a,value:"に保存されるのは、画像のデータではなくパスです。"},{type:b,tag:i,props:{},children:[]},{type:a,value:"\n取得した画像データは"},{type:b,tag:d,props:{},children:[{type:a,value:w}]},{type:a,value:"ではなく、"},{type:b,tag:d,props:{},children:[{type:a,value:$}]},{type:a,value:"の中に配列で格納されます。"},{type:b,tag:i,props:{},children:[]},{type:a,value:"\n画像のプレビューなど、取得した画像をページ上に再描写させる機能を実装する際には、"},{type:b,tag:d,props:{},children:[{type:a,value:w}]},{type:a,value:aM},{type:b,tag:d,props:{},children:[{type:a,value:$}]},{type:a,value:"のデータを用いることになります。"}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"また、"},{type:b,tag:d,props:{},children:[{type:a,value:z}]},{type:a,value:an},{type:b,tag:d,props:{},children:[{type:a,value:w}]},{type:a,value:"にはアクセス制約あるため、取得した画像ファイルのフルパスは取得できません。"},{type:b,tag:i,props:{},children:[]},{type:a,value:"\n各ブラウザによって取得されるパスの形式は異なりますが、大体の場合「C:\u002Ffakepath\u002F」などのダミーパスが表示されます。"},{type:b,tag:i,props:{},children:[]},{type:a,value:"\nもし、ファイル名をページ上に表示させる画面を作りたいのであれば、ファイル名の取得には、"},{type:b,tag:d,props:{},children:[{type:a,value:w}]},{type:a,value:aM},{type:b,tag:d,props:{},children:[{type:a,value:"files[i].name"}]},{type:a,value:"を用いたほうがよいでしょう。"}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"同じくセキュリティの観点から、"},{type:b,tag:d,props:{},children:[{type:a,value:w}]},{type:a,value:"そのものを修正することも禁止されています。"}]},{type:a,value:e},{type:b,tag:F,props:{id:aJ},children:[{type:b,tag:j,props:{href:"#2-input-typefile%E3%81%A7%E5%8F%96%E5%BE%97%E3%81%97%E3%81%9F%E7%94%BB%E5%83%8F%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AF%E3%80%81%E7%BD%AE%E3%81%8D%E6%8F%9B%E3%81%88%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84",ariaHidden:A,tabIndex:G},children:[{type:b,tag:c,props:{className:[H,I]},children:[]}]},{type:a,value:"2. "},{type:b,tag:d,props:{},children:[{type:a,value:z}]},{type:a,value:"で取得した画像データは、置き換えできない"}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:b,tag:d,props:{},children:[{type:a,value:$}]},{type:a,value:"には"},{type:b,tag:d,props:{},children:[{type:a,value:ap}]},{type:a,value:"コンストラクタが"},{type:b,tag:d,props:{},children:[{type:a,value:aN}]},{type:a,value:"という名の配列になって格納されています。 "}]},{type:a,value:e},{type:b,tag:n,props:{className:[t]},children:[{type:b,tag:u,props:{},children:[{type:b,tag:d,props:{className:[v,ao]},children:[{type:b,tag:c,props:{className:[B]},children:[{type:a,value:aN}]},{type:a,value:" {"},{type:b,tag:c,props:{className:[g]},children:[{type:a,value:aq}]},{type:a,value:": File, length: "},{type:b,tag:c,props:{className:[g]},children:[{type:a,value:ar}]},{type:a,value:"}\n  "},{type:b,tag:c,props:{className:[B]},children:[{type:a,value:aq}]},{type:a,value:": File\n    "},{type:b,tag:c,props:{className:[B]},children:[{type:a,value:"lastModified"}]},{type:a,value:h},{type:b,tag:c,props:{className:[g]},children:[{type:a,value:"1607151722901"}]},{type:a,value:aa},{type:b,tag:c,props:{className:[B]},children:[{type:a,value:"lastModifiedDate"}]},{type:a,value:": Sat Dec "},{type:b,tag:c,props:{className:[g]},children:[{type:a,value:V}]},{type:a,value:y},{type:b,tag:c,props:{className:[g]},children:[{type:a,value:W}]},{type:a,value:y},{type:b,tag:c,props:{className:[g]},children:[{type:a,value:aO}]},{type:a,value:N},{type:b,tag:c,props:{className:[g]},children:[{type:a,value:aP}]},{type:a,value:N},{type:b,tag:c,props:{className:[g]},children:[{type:a,value:aP}]},{type:a,value:" GMT+"},{type:b,tag:c,props:{className:[g]},children:[{type:a,value:"0900"}]},{type:a,value:" (日本標準時) {}\n    "},{type:b,tag:c,props:{className:[B]},children:[{type:a,value:"name"}]},{type:a,value:h},{type:b,tag:c,props:{className:[l]},children:[{type:a,value:"\"image.jpg\""}]},{type:a,value:aa},{type:b,tag:c,props:{className:[B]},children:[{type:a,value:aQ}]},{type:a,value:h},{type:b,tag:c,props:{className:[g]},children:[{type:a,value:"145455"}]},{type:a,value:aa},{type:b,tag:c,props:{className:[B]},children:[{type:a,value:aR}]},{type:a,value:h},{type:b,tag:c,props:{className:[l]},children:[{type:a,value:"\"image\u002Fjpeg\""}]},{type:a,value:aa},{type:b,tag:c,props:{className:[B]},children:[{type:a,value:"webkitRelativePath"}]},{type:a,value:h},{type:b,tag:c,props:{className:[l]},children:[{type:a,value:"\"\""}]},{type:a,value:"\n  "},{type:b,tag:c,props:{className:[B]},children:[{type:a,value:"length"}]},{type:a,value:h},{type:b,tag:c,props:{className:[g]},children:[{type:a,value:ar}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:b,tag:d,props:{},children:[{type:a,value:ap}]},{type:a,value:"は、"},{type:b,tag:d,props:{},children:[{type:a,value:"new File()"}]},{type:a,value:"とすることで生成できるため、一見上書きが可能なように見えます。"},{type:b,tag:i,props:{},children:[]},{type:a,value:"\nしかし、実際に"},{type:b,tag:d,props:{},children:[{type:a,value:$}]},{type:a,value:"を故意に"},{type:b,tag:d,props:{},children:[{type:a,value:ap}]},{type:a,value:"で上書きしようとすると失敗します。"}]},{type:a,value:e},{type:b,tag:n,props:{className:[t]},children:[{type:b,tag:u,props:{},children:[{type:b,tag:d,props:{className:[v,ao]},children:[{type:a,value:"Uncaught TypeError: Failed "},{type:b,tag:c,props:{className:[m]},children:[{type:a,value:"to"}]},{type:a,value:y},{type:b,tag:c,props:{className:[m]},children:[{type:a,value:aS}]},{type:a,value:" an indexed "},{type:b,tag:c,props:{className:[m]},children:[{type:a,value:aT}]},{type:a,value:y},{type:b,tag:c,props:{className:[m]},children:[{type:a,value:"on"}]},{type:a,value:y},{type:b,tag:c,props:{className:[l]},children:[{type:a,value:"'FileList'"}]},{type:a,value:h},{type:b,tag:c,props:{className:[m]},children:[{type:a,value:"Index"}]},{type:a,value:y},{type:b,tag:c,props:{className:[m]},children:[{type:a,value:aT}]},{type:a,value:" setter "},{type:b,tag:c,props:{className:[m]},children:[{type:a,value:"is"}]},{type:a,value:y},{type:b,tag:c,props:{className:[m]},children:[{type:a,value:"not"}]},{type:a,value:" supported.\n"}]}]}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"これも、"},{type:b,tag:d,props:{},children:[{type:a,value:z}]},{type:a,value:"のセキュリティが原因です。"}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"画像圧縮などでどうしてもデータを更新したいときには、画像をbase64に変換し、"},{type:b,tag:d,props:{},children:[{type:a,value:"\u003Cinput type=\"hidden\"\u003E"}]},{type:a,value:"など別のパーツにデータを保持させれば解決できます。"},{type:b,tag:i,props:{},children:[]},{type:a,value:e},{type:b,tag:d,props:{},children:[{type:a,value:z}]},{type:a,value:"に残っている元の画像データは、送信されないように削除しておくことを忘れずに。"}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"また、データが挿入できるということは、改竄もできるということです。"},{type:b,tag:i,props:{},children:[]},{type:a,value:e},{type:b,tag:d,props:{},children:[{type:a,value:w}]},{type:a,value:"の中身が改竄されたり、意図していないデータが送信されるリスクも存在します。"},{type:b,tag:i,props:{},children:[]},{type:a,value:"\nそのため、バックエンド側でのバリデーションや送信できるデータのサイズ制限は必須となります。"}]},{type:a,value:e},{type:b,tag:F,props:{id:_},children:[{type:b,tag:j,props:{href:"#%E3%81%BE%E3%81%A8%E3%82%81",ariaHidden:A,tabIndex:G},children:[{type:b,tag:c,props:{className:[H,I]},children:[]}]},{type:a,value:_}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"個人的に、フォーム関連パーツのHTMLとJavaScriptはなかなか融通が聞かない印象です。"},{type:b,tag:i,props:{},children:[]},{type:a,value:"\n難問にぶつかったとき、それを無理やり解決するのではなく、仕様をしっかり読み解いていくことを意識していきたいですね。"}]},{type:a,value:e},{type:b,tag:F,props:{id:E},children:[{type:b,tag:j,props:{href:aU,ariaHidden:A,tabIndex:G},children:[{type:b,tag:c,props:{className:[H,I]},children:[]}]},{type:a,value:E}]},{type:a,value:e},{type:b,tag:as,props:{},children:[{type:a,value:e},{type:b,tag:O,props:{},children:[{type:b,tag:j,props:{href:"https:\u002F\u002Fdeveloper.mozilla.org\u002Fja\u002Fdocs\u002FWeb\u002FAPI\u002FFile\u002FFile",rel:[p,q,r],target:s},children:[{type:a,value:"File.File() - Web API | MDN"}]}]},{type:a,value:e},{type:b,tag:O,props:{},children:[{type:b,tag:j,props:{href:"https:\u002F\u002Fdeveloper.mozilla.org\u002Fja\u002Fdocs\u002FWeb\u002FHTML\u002FElement\u002Finput\u002Ffile",rel:[p,q,r],target:s},children:[{type:a,value:"\u003Cinput type=\"file\"\u003E - HTML: HyperText Markup Language | MDN"}]}]},{type:a,value:e}]}]},text:"\nこの記事は[JavaScript Advent Calendar 2020](https:\u002F\u002Fqiita.com\u002Fadvent-calendar\u002F2020\u002Fjavascript)の25日目になります。\n\nレビューサイトを始めとする「ユーザーが画像ファイルをそれぞれがアップロードして投稿するウェブサイト」を作るとき、必ず用いられるのが`\u003Cinput type=\"file\"\u003E`によるアップロードです。\n\n一般的にファイルのアップロードといえば、PHPやSQLといったバックエンド技術が主役のように捉えられがちです。  \nしかし、取得した画像ファイルを用いたサムネイルの生成や画像ファイルの軽量化など、JavaScriptの出番も少なくありません。 \n\n実際に`\u003Cinput type=\"file\"\u003E`を取り扱い、いくつかハマりやすいと感じたポイントがあったため、この場を借りてまとめていきます。\n\n## 1. `\u003Cinput type=\"file\"\u003E`の`value`は、画像データではない\n\n`\u003Cinput\u003E`要素は、入力されたテキストをステータスを`value`の中に格納し、保持します。  \n`\u003Cinput type=\"file\"\u003E`を例外ではなく、`value`で値を受け取り、`value`を空にすることでデータを削除することができます。\nしかし、その`value`内部を`console.log`で確認すると、値は画像データではありませんでした。\n\n```\nC:\\fakepath\\image.jpg\n```\n\n`\u003Cinput type=\"file\"\u003E`の`value`に保存されるのは、画像のデータではなくパスです。  \n取得した画像データは`value`ではなく、`files`の中に配列で格納されます。  \n画像のプレビューなど、取得した画像をページ上に再描写させる機能を実装する際には、`value`ではなく`files`のデータを用いることになります。\n\nまた、`\u003Cinput type=\"file\"\u003E`の`value`にはアクセス制約あるため、取得した画像ファイルのフルパスは取得できません。  \n各ブラウザによって取得されるパスの形式は異なりますが、大体の場合「C:\u002Ffakepath\u002F」などのダミーパスが表示されます。  \nもし、ファイル名をページ上に表示させる画面を作りたいのであれば、ファイル名の取得には、`value`ではなく`files[i].name`を用いたほうがよいでしょう。\n\n同じくセキュリティの観点から、`value`そのものを修正することも禁止されています。\n## 2. `\u003Cinput type=\"file\"\u003E`で取得した画像データは、置き換えできない\n\n`files`には`File`コンストラクタが`FileList`という名の配列になって格納されています。 \n\n```\nFileList {0: File, length: 1}\n  0: File\n    lastModified: 1607151722901\n    lastModifiedDate: Sat Dec 05 2020 16:02:02 GMT+0900 (日本標準時) {}\n    name: \"image.jpg\"\n    size: 145455\n    type: \"image\u002Fjpeg\"\n    webkitRelativePath: \"\"\n  length: 1\n```\n\n`File`は、`new File()`とすることで生成できるため、一見上書きが可能なように見えます。  \nしかし、実際に`files`を故意に`File`で上書きしようとすると失敗します。\n\n```\nUncaught TypeError: Failed to set an indexed property on 'FileList': Index property setter is not supported.\n```\n\nこれも、`\u003Cinput type=\"file\"\u003E`のセキュリティが原因です。\n\n画像圧縮などでどうしてもデータを更新したいときには、画像をbase64に変換し、`\u003Cinput type=\"hidden\"\u003E`など別のパーツにデータを保持させれば解決できます。  \n`\u003Cinput type=\"file\"\u003E`に残っている元の画像データは、送信されないように削除しておくことを忘れずに。\n\nまた、データが挿入できるということは、改竄もできるということです。  \n`value`の中身が改竄されたり、意図していないデータが送信されるリスクも存在します。  \nそのため、バックエンド側でのバリデーションや送信できるデータのサイズ制限は必須となります。\n\n## まとめ\n\n個人的に、フォーム関連パーツのHTMLとJavaScriptはなかなか融通が聞かない印象です。  \n難問にぶつかったとき、それを無理やり解決するのではなく、仕様をしっかり読み解いていくことを意識していきたいですね。\n\n## 参考\n\n- [File.File() - Web API | MDN](https:\u002F\u002Fdeveloper.mozilla.org\u002Fja\u002Fdocs\u002FWeb\u002FAPI\u002FFile\u002FFile)\n- [&lt;input type=&quot;file&quot;&gt; - HTML: HyperText Markup Language | MDN](https:\u002F\u002Fdeveloper.mozilla.org\u002Fja\u002Fdocs\u002FWeb\u002FHTML\u002FElement\u002Finput\u002Ffile)\n",dir:P,path:"\u002Farticle\u002F20201225",extension:Q,createdAt:X,updatedAt:X},{slug:"20201215",title:"IEではinnerHTMLで削除したDOMを再利用できない",timestamp:"2020\u002F12\u002F15",tags:[Z],toc:[],body:{type:M,children:[{type:b,tag:f,props:{},children:[{type:a,value:"表題の通り、短めのお話。"},{type:b,tag:i,props:{},children:[]},{type:a,value:"\nあるコンテンツ内のデータをいったん削除して配置し直すとき、"},{type:b,tag:d,props:{},children:[{type:a,value:"innerHTML = ''"}]},{type:a,value:"によって削除されたDOMをIEでは再取得できない。"}]},{type:a,value:e},{type:b,tag:n,props:{className:[t]},children:[{type:b,tag:u,props:{},children:[{type:b,tag:d,props:{className:[v,J]},children:[{type:b,tag:c,props:{className:[m]},children:[{type:a,value:R}]},{type:a,value:aV},{type:b,tag:c,props:{className:[ab]},children:[{type:a,value:aW}]},{type:a,value:aX},{type:b,tag:c,props:{className:[l]},children:[{type:a,value:aY}]},{type:a,value:ac},{type:b,tag:c,props:{className:[m]},children:[{type:a,value:R}]},{type:a,value:aZ},{type:b,tag:c,props:{className:[l]},children:[{type:a,value:a_}]},{type:a,value:");\n\nwrap.innerHTML = "},{type:b,tag:c,props:{className:[l]},children:[{type:a,value:"''"}]},{type:a,value:";\n\nitems.forEach("},{type:b,tag:c,props:{className:[at]},children:[{type:a,value:ad},{type:b,tag:c,props:{className:[au]},children:[{type:a,value:av}]},{type:a,value:aw}]},{type:a,value:a$},{type:b,tag:c,props:{className:[K]},children:[{type:a,value:ba}]},{type:a,value:bb}]}]}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:b,tag:d,props:{},children:[{type:a,value:"removeChild"}]},{type:a,value:"を用いることでIEでもDOMを再利用することができる。"}]},{type:a,value:e},{type:b,tag:n,props:{className:[t]},children:[{type:b,tag:u,props:{},children:[{type:b,tag:d,props:{className:[v,J]},children:[{type:b,tag:c,props:{className:[m]},children:[{type:a,value:R}]},{type:a,value:aV},{type:b,tag:c,props:{className:[ab]},children:[{type:a,value:aW}]},{type:a,value:aX},{type:b,tag:c,props:{className:[l]},children:[{type:a,value:aY}]},{type:a,value:ac},{type:b,tag:c,props:{className:[m]},children:[{type:a,value:R}]},{type:a,value:aZ},{type:b,tag:c,props:{className:[l]},children:[{type:a,value:a_}]},{type:a,value:");\n\nitems.forEach("},{type:b,tag:c,props:{className:[at]},children:[{type:a,value:ad},{type:b,tag:c,props:{className:[au]},children:[{type:a,value:av}]},{type:a,value:aw}]},{type:a,value:" {\n  item.parentNode.removeChild(item);\n});\n\nitems.forEach("},{type:b,tag:c,props:{className:[at]},children:[{type:a,value:ad},{type:b,tag:c,props:{className:[au]},children:[{type:a,value:av}]},{type:a,value:aw}]},{type:a,value:a$},{type:b,tag:c,props:{className:[K]},children:[{type:a,value:ba}]},{type:a,value:bb}]}]}]}]},text:"\n表題の通り、短めのお話。  \nあるコンテンツ内のデータをいったん削除して配置し直すとき、`innerHTML = ''`によって削除されたDOMをIEでは再取得できない。\n\n```javascript\nconst wrap = document.querySelector('.wrap');\nconst items = wrap.querySelectorAll('.item');\n\nwrap.innerHTML = '';\n\nitems.forEach((item) =\u003E {\n  wrap.appendChild(item); \u002F\u002F Error\n});\n```\n\n`removeChild`を用いることでIEでもDOMを再利用することができる。\n\n```javascript\nconst wrap = document.querySelector('.wrap');\nconst items = wrap.querySelectorAll('.item');\n\nitems.forEach((item) =\u003E {\n  item.parentNode.removeChild(item);\n});\n\nitems.forEach((item) =\u003E {\n  wrap.appendChild(item); \u002F\u002F Error\n});\n```\n",dir:P,path:"\u002Farticle\u002F20201215",extension:Q,createdAt:X,updatedAt:X},{slug:"20201126",title:"\u003Cbutton\u003Eってなんなんだ？",timestamp:"2020\u002F11\u002F26",tags:[aH,Z],toc:[],body:{type:M,children:[{type:b,tag:f,props:{},children:[{type:a,value:"業務でコードレビューをしていたところ、以下のようなソースに出会った。"}]},{type:a,value:e},{type:b,tag:n,props:{className:[t]},children:[{type:b,tag:u,props:{},children:[{type:b,tag:d,props:{className:[v,bc]},children:[{type:b,tag:c,props:{className:[S]},children:[{type:a,value:ax},{type:b,tag:c,props:{className:[T]},children:[{type:a,value:ay}]},{type:a,value:U}]},{type:a,value:az},{type:b,tag:c,props:{className:[S]},children:[{type:a,value:aA},{type:b,tag:c,props:{className:[T]},children:[{type:a,value:ay}]},{type:a,value:U}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"JavaScriptを用いて、押下することで詳細な説明や注意事項を表示したモーダルが表示される機能が実装されている様子。"},{type:b,tag:i,props:{},children:[]},{type:a,value:"\n何気なしに「submitボタンでないのであれば、"},{type:b,tag:d,props:{},children:[{type:a,value:aB}]},{type:a,value:"を追加してください」とレビューしたところ、「submitボタンってなんですか？」とのお返事。学習も兼ねて色々と調べ直すことにした。"}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:b,tag:d,props:{},children:[{type:a,value:Y}]},{type:a,value:"要素には"},{type:b,tag:d,props:{},children:[{type:a,value:aR}]},{type:a,value:"という属性値が存在し、初期値は"},{type:b,tag:d,props:{},children:[{type:a,value:bd}]},{type:a,value:be},{type:b,tag:i,props:{},children:[]},{type:a,value:e},{type:b,tag:d,props:{},children:[{type:a,value:"type=\"submit\""}]},{type:a,value:"を持つ"},{type:b,tag:d,props:{},children:[{type:a,value:Y}]},{type:a,value:"要素は、親として"},{type:b,tag:d,props:{},children:[{type:a,value:ae}]},{type:a,value:"要素を持つ場合、その中に含まれる"},{type:b,tag:d,props:{},children:[{type:a,value:aK}]},{type:a,value:"情報を送信することができる。"}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"その他、選択できる値は以下の通り。"}]},{type:a,value:"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"},{type:b,tag:"table",props:{},children:[{type:b,tag:"thead",props:{},children:[{type:b,tag:af,props:{},children:[{type:b,tag:aC,props:{align:x},children:[{type:a,value:"キーワード"}]},{type:b,tag:aC,props:{align:x},children:[{type:a,value:"状態"}]},{type:b,tag:aC,props:{align:x},children:[{type:a,value:"概要"}]}]}]},{type:b,tag:"tbody",props:{},children:[{type:b,tag:af,props:{},children:[{type:b,tag:C,props:{align:x},children:[{type:a,value:bd}]},{type:b,tag:C,props:{align:x},children:[{type:a,value:"Submit Button"}]},{type:b,tag:C,props:{align:x},children:[{type:a,value:"フォームを送信する。"}]}]},{type:b,tag:af,props:{},children:[{type:b,tag:C,props:{align:x},children:[{type:a,value:"reset"}]},{type:b,tag:C,props:{align:x},children:[{type:a,value:"Reset Button"}]},{type:b,tag:C,props:{align:x},children:[{type:a,value:"フォームをリセットする。"}]}]},{type:b,tag:af,props:{},children:[{type:b,tag:C,props:{align:x},children:[{type:a,value:ay}]},{type:b,tag:C,props:{align:x},children:[{type:a,value:"Button"}]},{type:b,tag:C,props:{align:x},children:[{type:a,value:bf}]}]}]}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"参考："},{type:b,tag:j,props:{href:"https:\u002F\u002Fmomdo.github.io\u002Fhtml\u002Fform-elements.html#the-button-element",rel:[p,q,r],target:s},children:[{type:a,value:"HTML Standard"}]}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"そもそも"},{type:b,tag:d,props:{},children:[{type:a,value:Y}]},{type:a,value:"要素で生成されるボタンは、"},{type:b,tag:d,props:{},children:[{type:a,value:ae}]},{type:a,value:"要素を操作するためのボタンということになる。"},{type:b,tag:i,props:{},children:[]},{type:a,value:"\nコードレビューでいただいた、「submitボタンとは？」という質問に回答するのであれば、「フォームを送信（submit）するためのボタン」がsubmitボタンだということになる。"}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"では、"},{type:b,tag:d,props:{},children:[{type:a,value:ae}]},{type:a,value:"要素を親として持たない"},{type:b,tag:d,props:{},children:[{type:a,value:Y}]},{type:a,value:"要素はどのような振る舞いをするか。"}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"注目すべきは"},{type:b,tag:d,props:{},children:[{type:a,value:aB}]},{type:a,value:be},{type:b,tag:i,props:{},children:[]},{type:a,value:"\n概要は、"}]},{type:a,value:e},{type:b,tag:bg,props:{},children:[{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:bf}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"文字通り、"},{type:b,tag:d,props:{},children:[{type:a,value:aB}]},{type:a,value:"を付与された"},{type:b,tag:d,props:{},children:[{type:a,value:Y}]},{type:a,value:"要素は何もしない。"},{type:b,tag:i,props:{},children:[]},{type:a,value:"\n仮に親として"},{type:b,tag:d,props:{},children:[{type:a,value:ae}]},{type:a,value:"要素を持っていたとしても、データの更新や遷移を行わない。"},{type:b,tag:i,props:{},children:[]},{type:a,value:"\n要するに、古いソースコードに散見される"}]},{type:a,value:e},{type:b,tag:n,props:{className:[t]},children:[{type:b,tag:u,props:{},children:[{type:b,tag:d,props:{className:[v,bc]},children:[{type:b,tag:c,props:{className:[S]},children:[{type:a,value:ax},{type:b,tag:c,props:{className:[T]},children:[{type:a,value:n}]},{type:a,value:y},{type:b,tag:c,props:{className:[k]},children:[{type:a,value:"onClick"}]},{type:a,value:bh},{type:b,tag:c,props:{className:[l]},children:[{type:a,value:"\"...\""}]},{type:a,value:U}]},{type:a,value:az},{type:b,tag:c,props:{className:[S]},children:[{type:a,value:aA},{type:b,tag:c,props:{className:[T]},children:[{type:a,value:n}]},{type:a,value:U}]},{type:a,value:e},{type:b,tag:c,props:{className:[S]},children:[{type:a,value:ax},{type:b,tag:c,props:{className:[T]},children:[{type:a,value:j}]},{type:a,value:y},{type:b,tag:c,props:{className:[k]},children:[{type:a,value:bi}]},{type:a,value:bh},{type:b,tag:c,props:{className:[l]},children:[{type:a,value:"\"javascript:void(0)\""}]},{type:a,value:U}]},{type:a,value:az},{type:b,tag:c,props:{className:[S]},children:[{type:a,value:aA},{type:b,tag:c,props:{className:[T]},children:[{type:a,value:j}]},{type:a,value:U}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"と同じ振る舞いをするわけだ。"}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:b,tag:d,props:{},children:[{type:a,value:bj}]},{type:a,value:"要素や"},{type:b,tag:d,props:{},children:[{type:a,value:bk}]},{type:a,value:"要素を用いたレガシーコードが良くないとされる理由は、主に以下である。"}]},{type:a,value:e},{type:b,tag:as,props:{},children:[{type:a,value:e},{type:b,tag:O,props:{},children:[{type:a,value:"ページ遷移を伴わない"},{type:b,tag:d,props:{},children:[{type:a,value:bk}]},{type:a,value:"要素は、そもそも「リンク」としての意味合いを持たない"}]},{type:a,value:e},{type:b,tag:O,props:{},children:[{type:b,tag:d,props:{},children:[{type:a,value:bj}]},{type:a,value:"要素にはデフォルトだとフォーカスがないため、タブフォーカスでページを巡回した際、ボタンをスキップしてしまう"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"HTML5を正しく活用するためにも、リンクでなく、押下し、かつフォームパーツでないボタンには、"},{type:b,tag:d,props:{},children:[{type:a,value:"\u003Cbutton type=\"button\"\u003E"}]},{type:a,value:"を使うべきだと言えるだろう。"}]}]},text:"\n業務でコードレビューをしていたところ、以下のようなソースに出会った。\n\n```html\n\u003Cbutton\u003E詳しく見る\u003C\u002Fbutton\u003E\n```\n\nJavaScriptを用いて、押下することで詳細な説明や注意事項を表示したモーダルが表示される機能が実装されている様子。  \n何気なしに「submitボタンでないのであれば、`type=\"button\"`を追加してください」とレビューしたところ、「submitボタンってなんですか？」とのお返事。学習も兼ねて色々と調べ直すことにした。\n\n`\u003Cbutton\u003E`要素には`type`という属性値が存在し、初期値は`submit`。  \n`type=\"submit\"`を持つ`\u003Cbutton\u003E`要素は、親として`\u003Cform\u003E`要素を持つ場合、その中に含まれる`\u003Cinput\u003E`情報を送信することができる。\n\nその他、選択できる値は以下の通り。\n\n| キーワード | 状態 |\t概要 |\n| :- | :- | :- |\n| submit | Submit Button | フォームを送信する。 |\n| reset | Reset Button | フォームをリセットする。 |\n| button | Button | 何もしない。 |\n\n参考：[HTML Standard](https:\u002F\u002Fmomdo.github.io\u002Fhtml\u002Fform-elements.html#the-button-element)\n\nそもそも`\u003Cbutton\u003E`要素で生成されるボタンは、`\u003Cform\u003E`要素を操作するためのボタンということになる。  \nコードレビューでいただいた、「submitボタンとは？」という質問に回答するのであれば、「フォームを送信（submit）するためのボタン」がsubmitボタンだということになる。\n\nでは、`\u003Cform\u003E`要素を親として持たない`\u003Cbutton\u003E`要素はどのような振る舞いをするか。\n\n注目すべきは`type=\"button\"`。  \n概要は、\n\n\u003E何もしない。\n\n文字通り、`type=\"button\"`を付与された`\u003Cbutton\u003E`要素は何もしない。  \n仮に親として`\u003Cform\u003E`要素を持っていたとしても、データの更新や遷移を行わない。  \n要するに、古いソースコードに散見される\n\n```html\n\u003Cdiv onClick=\"...\"\u003E詳しく見る\u003C\u002Fdiv\u003E\n\u003Ca href=\"javascript:void(0)\"\u003E詳しく見る\u003C\u002Fa\u003E\n```\n\nと同じ振る舞いをするわけだ。\n\n`\u003Cdiv\u003E`要素や`\u003Ca\u003E`要素を用いたレガシーコードが良くないとされる理由は、主に以下である。\n\n- ページ遷移を伴わない`\u003Ca\u003E`要素は、そもそも「リンク」としての意味合いを持たない\n- `\u003Cdiv\u003E`要素にはデフォルトだとフォーカスがないため、タブフォーカスでページを巡回した際、ボタンをスキップしてしまう\n\nHTML5を正しく活用するためにも、リンクでなく、押下し、かつフォームパーツでないボタンには、`\u003Cbutton type=\"button\"\u003E`を使うべきだと言えるだろう。\n\n",dir:P,path:"\u002Farticle\u002F20201126",extension:Q,createdAt:L,updatedAt:X},{slug:"20201111",title:"ブログをリニューアルしました",timestamp:"2020\u002F11\u002F11",tags:["日記"],toc:[],body:{type:M,children:[{type:b,tag:f,props:{},children:[{type:a,value:"表題の通り、ブログをリニューアルしました。"},{type:b,tag:i,props:{},children:[]},{type:a,value:"\n旧ブログの技術的ナレッジのみ移行し、ほぼ新規で投稿していきます。"}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"ブログサービスを用いらず、独自での開発を行った理由としては主に2つあります。"}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"① 際限なく自由に遊べる環境が欲しかった"}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"曲がりなりにもエンジニアですので、既存のサービスを使うよりも自由度が高い独自開発に憧れがありました。"},{type:b,tag:i,props:{},children:[]},{type:a,value:"\nブログ以外のディレクトリも活用しつつ、サンドボックス的に遊べるような運用を目指します。 "}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"② 技術ブログ以外のブログを書きたかった"}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"日常ブログと技術ブログが混じってしまうのが悩みでした。\nカテゴリ分けなどうまく実装しながら、好きなことを好きなだけ書ける場所として使っていきたいと思います。"}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"他にも試したいことは多々ありますが、都度調整しつつ、まったりと運用する予定です。"},{type:b,tag:i,props:{},children:[]},{type:a,value:"\n今後ともよろしくお願いいたします。"}]}]},text:"\n表題の通り、ブログをリニューアルしました。  \n旧ブログの技術的ナレッジのみ移行し、ほぼ新規で投稿していきます。\n\nブログサービスを用いらず、独自での開発を行った理由としては主に2つあります。\n\n① 際限なく自由に遊べる環境が欲しかった\n\n曲がりなりにもエンジニアですので、既存のサービスを使うよりも自由度が高い独自開発に憧れがありました。  \nブログ以外のディレクトリも活用しつつ、サンドボックス的に遊べるような運用を目指します。 \n\n② 技術ブログ以外のブログを書きたかった\n\n日常ブログと技術ブログが混じってしまうのが悩みでした。\nカテゴリ分けなどうまく実装しながら、好きなことを好きなだけ書ける場所として使っていきたいと思います。\n\n他にも試したいことは多々ありますが、都度調整しつつ、まったりと運用する予定です。  \n今後ともよろしくお願いいたします。\n",dir:P,path:"\u002Farticle\u002F20201111",extension:Q,createdAt:L,updatedAt:L},{slug:"20200806",title:"URLパラメータに関する備忘録",timestamp:"2020\u002F08\u002F06",tags:[Z],toc:[{id:bl,depth:D,text:bm},{id:ag,depth:D,text:ag},{id:ah,depth:D,text:ah},{id:E,depth:D,text:E}],body:{type:M,children:[{type:b,tag:f,props:{},children:[{type:a,value:"APIを用いた設計を行っているとURLパラメータを操作したいという状況に多々遭遇します。"},{type:b,tag:i,props:{},children:[]},{type:a,value:"\n古典的に、"},{type:b,tag:d,props:{},children:[{type:a,value:"location.search"}]},{type:a,value:"で取得した文字列を分割して、変換して・・・を繰り返していると、どこかで不具合にぶつかるものです。"},{type:b,tag:i,props:{},children:[]},{type:a,value:e},{type:b,tag:d,props:{},children:[{type:a,value:"URL"}]},{type:a,value:"を用いることで、パラメータをスムーズに付け外しすることができると学んだので、備忘録として記載します。"}]},{type:a,value:e},{type:b,tag:F,props:{id:bl},children:[{type:b,tag:j,props:{href:"#url%E3%81%AE%E5%8F%96%E5%BE%97",ariaHidden:A,tabIndex:G},children:[{type:b,tag:c,props:{className:[H,I]},children:[]}]},{type:a,value:bm}]},{type:a,value:e},{type:b,tag:n,props:{className:[t]},children:[{type:b,tag:u,props:{},children:[{type:b,tag:d,props:{className:[v,J]},children:[{type:b,tag:c,props:{className:[m]},children:[{type:a,value:ai}]},{type:a,value:bn}]}]}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:b,tag:d,props:{},children:[{type:a,value:"location.href"}]},{type:a,value:"の部分にはもっと細かい書き方が多くありますが、既に付与されているパラメータをURLごと全て取得したいのであればこれが1番シンプルかなと思います。"},{type:b,tag:i,props:{},children:[]},{type:a,value:"\nAPIを使う時など、現在のURLとは別に新しくURLを生成したいのであれば、"}]},{type:a,value:e},{type:b,tag:n,props:{className:[t]},children:[{type:b,tag:u,props:{},children:[{type:b,tag:d,props:{className:[v,J]},children:[{type:b,tag:c,props:{className:[m]},children:[{type:a,value:ai}]},{type:a,value:" URL("},{type:b,tag:c,props:{className:[l]},children:[{type:a,value:"'\u002Fapi\u002Fxxx'"}]},{type:a,value:aj},{type:b,tag:c,props:{className:[l]},children:[{type:a,value:"'https:\u002F\u002Fexample.com'"}]},{type:a,value:ac}]}]}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"とすることで取得できます。  "}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"URLに反映するときは、"}]},{type:a,value:e},{type:b,tag:n,props:{className:[t]},children:[{type:b,tag:u,props:{},children:[{type:b,tag:d,props:{className:[v,J]},children:[{type:a,value:"location.href = "},{type:b,tag:c,props:{className:[m]},children:[{type:a,value:ai}]},{type:a,value:bn}]}]}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"で反映できます。"}]},{type:a,value:e},{type:b,tag:F,props:{id:ag},children:[{type:b,tag:j,props:{href:"#%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E3%81%AE%E8%BF%BD%E5%8A%A0",ariaHidden:A,tabIndex:G},children:[{type:b,tag:c,props:{className:[H,I]},children:[]}]},{type:a,value:ag}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"URLインターフェースで生成したURLからは、リンク要素と同じように"},{type:b,tag:d,props:{},children:[{type:a,value:bi}]},{type:a,value:aD},{type:b,tag:d,props:{},children:[{type:a,value:"hash"}]},{type:a,value:"を取得することができます。\nパラメータに関しても"},{type:b,tag:d,props:{},children:[{type:a,value:"search"}]},{type:a,value:"で取得することができますが、"},{type:b,tag:d,props:{},children:[{type:a,value:aE}]},{type:a,value:"から始まる文字列では使い勝手が悪いので、"},{type:b,tag:d,props:{},children:[{type:a,value:bo}]},{type:a,value:"を使用して取得します。"}]},{type:a,value:e},{type:b,tag:n,props:{className:[t]},children:[{type:b,tag:u,props:{},children:[{type:b,tag:d,props:{className:[v,J]},children:[{type:b,tag:c,props:{className:[m]},children:[{type:a,value:R}]},{type:a,value:" url = "},{type:b,tag:c,props:{className:[m]},children:[{type:a,value:ai}]},{type:a,value:" URL(location.href); "},{type:b,tag:c,props:{className:[K]},children:[{type:a,value:"\u002F\u002F https:\u002F\u002Fexample.com?id=0"}]},{type:a,value:"\n\nurl.searchParams.set("},{type:b,tag:c,props:{className:[l]},children:[{type:a,value:"'id'"}]},{type:a,value:aj},{type:b,tag:c,props:{className:[l]},children:[{type:a,value:"'1'"}]},{type:a,value:aF},{type:b,tag:c,props:{className:[K]},children:[{type:a,value:"\u002F\u002F https:\u002F\u002Fexample.com?id=1"}]},{type:a,value:"\nurl.searchParams.set("},{type:b,tag:c,props:{className:[l]},children:[{type:a,value:bp}]},{type:a,value:aj},{type:b,tag:c,props:{className:[l]},children:[{type:a,value:bq}]},{type:a,value:aF},{type:b,tag:c,props:{className:[K]},children:[{type:a,value:"\u002F\u002F https:\u002F\u002Fexample.com?id=1&name=test"}]},{type:a,value:"\nurl.searchParams.append("},{type:b,tag:c,props:{className:[l]},children:[{type:a,value:bp}]},{type:a,value:aj},{type:b,tag:c,props:{className:[l]},children:[{type:a,value:bq}]},{type:a,value:aF},{type:b,tag:c,props:{className:[K]},children:[{type:a,value:"\u002F\u002F https:\u002F\u002Fexample.com?id=1&name=test&name=test"}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:b,tag:d,props:{},children:[{type:a,value:aS}]},{type:a,value:"は上書き、"},{type:b,tag:d,props:{},children:[{type:a,value:"append"}]},{type:a,value:"は既存に同じパラメータが存在したとしても新たに追加します。"}]},{type:a,value:e},{type:b,tag:F,props:{id:ah},children:[{type:b,tag:j,props:{href:"#%E3%81%9D%E3%81%AE%E4%BB%96",ariaHidden:A,tabIndex:G},children:[{type:b,tag:c,props:{className:[H,I]},children:[]}]},{type:a,value:ah}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"パラメータを削除する"},{type:b,tag:d,props:{},children:[{type:a,value:"delete"}]},{type:a,value:"や、パラメータを持っているかを返す"},{type:b,tag:d,props:{},children:[{type:a,value:"has"}]},{type:a,value:"なども存在します。"}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:b,tag:d,props:{},children:[{type:a,value:bo}]},{type:a,value:"を用いることで、"},{type:b,tag:d,props:{},children:[{type:a,value:aE}]},{type:a,value:aD},{type:b,tag:d,props:{},children:[{type:a,value:"&"}]},{type:a,value:"の付け忘れやエスケープによるヒューマンエラーも起きにくくなります。ソースコード上で何を行いたいのかも分かりやすくなります。"},{type:b,tag:i,props:{},children:[]},{type:a,value:"\n意外にも最近の技術ではなく、"},{type:b,tag:j,props:{href:"https:\u002F\u002Fcaniuse.com\u002F?search=URL",rel:[p,q,r],target:s},children:[{type:a,value:"ほぼ全てのブラウザ"}]},{type:a,value:"で対応している（IE除く）ので、どんどん使っていきたいですね。"}]},{type:a,value:e},{type:b,tag:F,props:{id:E},children:[{type:b,tag:j,props:{href:aU,ariaHidden:A,tabIndex:G},children:[{type:b,tag:c,props:{className:[H,I]},children:[]}]},{type:a,value:E}]},{type:a,value:e},{type:b,tag:as,props:{},children:[{type:a,value:e},{type:b,tag:O,props:{},children:[{type:b,tag:j,props:{href:"https:\u002F\u002Fdeveloper.mozilla.org\u002Fja\u002Fdocs\u002FWeb\u002FAPI\u002FURL",rel:[p,q,r],target:s},children:[{type:a,value:"URL - Web API | MDN"}]}]},{type:a,value:e},{type:b,tag:O,props:{},children:[{type:b,tag:j,props:{href:"https:\u002F\u002Fdeveloper.mozilla.org\u002Fja\u002Fdocs\u002FWeb\u002FAPI\u002FURLSearchParams",rel:[p,q,r],target:s},children:[{type:a,value:"URLSearchParams - Web API | MDN"}]}]},{type:a,value:e}]}]},text:"\nAPIを用いた設計を行っているとURLパラメータを操作したいという状況に多々遭遇します。  \n古典的に、`location.search`で取得した文字列を分割して、変換して・・・を繰り返していると、どこかで不具合にぶつかるものです。  \n`URL`を用いることで、パラメータをスムーズに付け外しすることができると学んだので、備忘録として記載します。\n\n## URLの取得\n\n```javascript\nnew URL(location.href);\n```\n\n`location.href`の部分にはもっと細かい書き方が多くありますが、既に付与されているパラメータをURLごと全て取得したいのであればこれが1番シンプルかなと思います。  \nAPIを使う時など、現在のURLとは別に新しくURLを生成したいのであれば、\n\n```javascript\nnew URL('\u002Fapi\u002Fxxx', 'https:\u002F\u002Fexample.com');\n```\n\nとすることで取得できます。  \n\nURLに反映するときは、\n\n```javascript\nlocation.href = new URL(location.href);\n```\n\nで反映できます。\n\n## パラメータの追加\n\nURLインターフェースで生成したURLからは、リンク要素と同じように`href`や`hash`を取得することができます。\nパラメータに関しても`search`で取得することができますが、`?`から始まる文字列では使い勝手が悪いので、`searchParams`を使用して取得します。\n\n```javascript\nconst url = new URL(location.href); \u002F\u002F https:\u002F\u002Fexample.com?id=0\n\nurl.searchParams.set('id', '1') \u002F\u002F https:\u002F\u002Fexample.com?id=1\nurl.searchParams.set('name', 'test') \u002F\u002F https:\u002F\u002Fexample.com?id=1&name=test\nurl.searchParams.append('name', 'test') \u002F\u002F https:\u002F\u002Fexample.com?id=1&name=test&name=test\n```\n\n`set`は上書き、`append`は既存に同じパラメータが存在したとしても新たに追加します。\n\n## その他\nパラメータを削除する`delete`や、パラメータを持っているかを返す`has`なども存在します。\n\n`searchParams`を用いることで、`?`や`&`の付け忘れやエスケープによるヒューマンエラーも起きにくくなります。ソースコード上で何を行いたいのかも分かりやすくなります。  \n意外にも最近の技術ではなく、[ほぼ全てのブラウザ](https:\u002F\u002Fcaniuse.com\u002F?search=URL)で対応している（IE除く）ので、どんどん使っていきたいですね。\n\n## 参考\n- [URL - Web API | MDN](https:\u002F\u002Fdeveloper.mozilla.org\u002Fja\u002Fdocs\u002FWeb\u002FAPI\u002FURL)\n- [URLSearchParams - Web API | MDN](https:\u002F\u002Fdeveloper.mozilla.org\u002Fja\u002Fdocs\u002FWeb\u002FAPI\u002FURLSearchParams)\n",dir:P,path:"\u002Farticle\u002F20200806",extension:Q,createdAt:L,updatedAt:L},{slug:"20200515",title:"klawでディレクトリ配下のファイルを再帰的に取得する",timestamp:"2020\u002F05\u002F15",tags:["Node.js"],toc:[],body:{type:M,children:[{type:b,tag:f,props:{},children:[{type:a,value:"あるディレクトリ配下に存在する全てのファイルに対しアクションを行いたい場合、"},{type:b,tag:j,props:{href:br,rel:[p,q,r],target:s},children:[{type:a,value:bs}]},{type:a,value:aD},{type:b,tag:j,props:{href:bt,rel:[p,q,r],target:s},children:[{type:a,value:bu}]},{type:a,value:"が便利だと知ったのでメモ。"}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"元々は、"},{type:b,tag:d,props:{},children:[{type:a,value:"fs"}]},{type:a,value:"の拡張である"},{type:b,tag:j,props:{href:"https:\u002F\u002Fgithub.com\u002Fjprichardson\u002Fnode-fs-extra",rel:[p,q,r],target:s},children:[{type:b,tag:d,props:{},children:[{type:a,value:bv}]}]},{type:a,value:"の内に含まれていた"},{type:b,tag:d,props:{},children:[{type:a,value:bw}]},{type:a,value:"が同じ役割を果たしていたようだが、"}]},{type:a,value:e},{type:b,tag:bg,props:{},children:[{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"What happened to "},{type:b,tag:d,props:{},children:[{type:a,value:"walk()"}]},{type:a,value:bx},{type:b,tag:d,props:{},children:[{type:a,value:"walkSync()"}]},{type:a,value:aE},{type:b,tag:i,props:{},children:[]},{type:a,value:"\nThey were removed from "},{type:b,tag:d,props:{},children:[{type:a,value:bv}]},{type:a,value:" in v2.0.0. If you need the functionality, "},{type:b,tag:d,props:{},children:[{type:a,value:bw}]},{type:a,value:" and walkSync are available as separate packages, "},{type:b,tag:j,props:{href:br,rel:[p,q,r],target:s},children:[{type:b,tag:d,props:{},children:[{type:a,value:bs}]}]},{type:a,value:bx},{type:b,tag:j,props:{href:bt,rel:[p,q,r],target:s},children:[{type:b,tag:d,props:{},children:[{type:a,value:bu}]}]},{type:a,value:"."}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"引用："},{type:b,tag:j,props:{href:"https:\u002F\u002Fwww.npmjs.com\u002Fpackage\u002Ffs-extra#what-happened-to-walk-and-walksync-",rel:[p,q,r],target:s},children:[{type:a,value:"fs-extra - npm"}]}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"とのことで、現在は個別にインストールする必要がある。"}]},{type:a,value:e},{type:b,tag:n,props:{className:[t]},children:[{type:b,tag:u,props:{},children:[{type:b,tag:d,props:{className:[v,J]},children:[{type:b,tag:c,props:{className:[m]},children:[{type:a,value:R}]},{type:a,value:" klawSync = "},{type:b,tag:c,props:{className:[ab]},children:[{type:a,value:"require"}]},{type:a,value:ad},{type:b,tag:c,props:{className:[l]},children:[{type:a,value:"'klaw-sync'"}]},{type:a,value:ac},{type:b,tag:c,props:{className:[m]},children:[{type:a,value:"let"}]},{type:a,value:" filelist = [];\n\n"},{type:b,tag:c,props:{className:[m]},children:[{type:a,value:"try"}]},{type:a,value:" {\n    filelist = klawSync("},{type:b,tag:c,props:{className:[l]},children:[{type:a,value:"'\u002Ffoo\u002Fbar'"}]},{type:a,value:", {\n        "},{type:b,tag:c,props:{className:[k]},children:[{type:a,value:"nodir"}]},{type:a,value:h},{type:b,tag:c,props:{className:["hljs-literal"]},children:[{type:a,value:A}]},{type:a,value:y},{type:b,tag:c,props:{className:[K]},children:[{type:a,value:"\u002F\u002F nodirを有効にすることでファイル名のみを出力"}]},{type:a,value:"\n    });\n} "},{type:b,tag:c,props:{className:[m]},children:[{type:a,value:"catch"}]},{type:a,value:" (err) {\n    "},{type:b,tag:c,props:{className:[ab]},children:[{type:a,value:"console"}]},{type:a,value:".error(err);\n}\n"}]}]}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:b,tag:d,props:{},children:[{type:a,value:"dirent"}]},{type:a,value:"の形式でファイルリストが出力される。"}]},{type:a,value:e},{type:b,tag:n,props:{className:[t]},children:[{type:b,tag:u,props:{},children:[{type:b,tag:d,props:{className:[v,J]},children:[{type:a,value:"[\n    {\n        "},{type:b,tag:c,props:{className:[k]},children:[{type:a,value:"path"}]},{type:a,value:h},{type:b,tag:c,props:{className:[l]},children:[{type:a,value:"'\u002Ffoo\u002Fbar\u002Fxxx.js'"}]},{type:a,value:",\n        "},{type:b,tag:c,props:{className:[k]},children:[{type:a,value:"stats"}]},{type:a,value:": Stats {\n            "},{type:b,tag:c,props:{className:[k]},children:[{type:a,value:"dev"}]},{type:a,value:h},{type:b,tag:c,props:{className:[g]},children:[{type:a,value:"16777221"}]},{type:a,value:o},{type:b,tag:c,props:{className:[k]},children:[{type:a,value:"mode"}]},{type:a,value:h},{type:b,tag:c,props:{className:[g]},children:[{type:a,value:"33188"}]},{type:a,value:o},{type:b,tag:c,props:{className:[k]},children:[{type:a,value:"nlink"}]},{type:a,value:h},{type:b,tag:c,props:{className:[g]},children:[{type:a,value:ar}]},{type:a,value:o},{type:b,tag:c,props:{className:[k]},children:[{type:a,value:"uid"}]},{type:a,value:h},{type:b,tag:c,props:{className:[g]},children:[{type:a,value:"502"}]},{type:a,value:o},{type:b,tag:c,props:{className:[k]},children:[{type:a,value:"gid"}]},{type:a,value:h},{type:b,tag:c,props:{className:[g]},children:[{type:a,value:"20"}]},{type:a,value:o},{type:b,tag:c,props:{className:[k]},children:[{type:a,value:"rdev"}]},{type:a,value:h},{type:b,tag:c,props:{className:[g]},children:[{type:a,value:aq}]},{type:a,value:o},{type:b,tag:c,props:{className:[k]},children:[{type:a,value:"blksize"}]},{type:a,value:h},{type:b,tag:c,props:{className:[g]},children:[{type:a,value:"4096"}]},{type:a,value:o},{type:b,tag:c,props:{className:[k]},children:[{type:a,value:"ino"}]},{type:a,value:h},{type:b,tag:c,props:{className:[g]},children:[{type:a,value:"725582"}]},{type:a,value:o},{type:b,tag:c,props:{className:[k]},children:[{type:a,value:aQ}]},{type:a,value:h},{type:b,tag:c,props:{className:[g]},children:[{type:a,value:"5523"}]},{type:a,value:o},{type:b,tag:c,props:{className:[k]},children:[{type:a,value:"blocks"}]},{type:a,value:h},{type:b,tag:c,props:{className:[g]},children:[{type:a,value:aO}]},{type:a,value:o},{type:b,tag:c,props:{className:[k]},children:[{type:a,value:"atimeMs"}]},{type:a,value:h},{type:b,tag:c,props:{className:[g]},children:[{type:a,value:"1589185938547.9219"}]},{type:a,value:o},{type:b,tag:c,props:{className:[k]},children:[{type:a,value:"mtimeMs"}]},{type:a,value:h},{type:b,tag:c,props:{className:[g]},children:[{type:a,value:by}]},{type:a,value:o},{type:b,tag:c,props:{className:[k]},children:[{type:a,value:"ctimeMs"}]},{type:a,value:h},{type:b,tag:c,props:{className:[g]},children:[{type:a,value:by}]},{type:a,value:o},{type:b,tag:c,props:{className:[k]},children:[{type:a,value:"birthtimeMs"}]},{type:a,value:h},{type:b,tag:c,props:{className:[g]},children:[{type:a,value:"1589185934632.7583"}]},{type:a,value:o},{type:b,tag:c,props:{className:[k]},children:[{type:a,value:"atime"}]},{type:a,value:h},{type:b,tag:c,props:{className:[g]},children:[{type:a,value:W}]},{type:a,value:ak},{type:b,tag:c,props:{className:[g]},children:[{type:a,value:V}]},{type:a,value:al},{type:b,tag:c,props:{className:[g]},children:[{type:a,value:am}]},{type:a,value:N},{type:b,tag:c,props:{className:[g]},children:[{type:a,value:"18."}]},{type:a,value:"548Z,\n            "},{type:b,tag:c,props:{className:[k]},children:[{type:a,value:"mtime"}]},{type:a,value:h},{type:b,tag:c,props:{className:[g]},children:[{type:a,value:W}]},{type:a,value:ak},{type:b,tag:c,props:{className:[g]},children:[{type:a,value:V}]},{type:a,value:al},{type:b,tag:c,props:{className:[g]},children:[{type:a,value:am}]},{type:a,value:N},{type:b,tag:c,props:{className:[g]},children:[{type:a,value:aG}]},{type:a,value:bz},{type:b,tag:c,props:{className:[k]},children:[{type:a,value:"ctime"}]},{type:a,value:h},{type:b,tag:c,props:{className:[g]},children:[{type:a,value:W}]},{type:a,value:ak},{type:b,tag:c,props:{className:[g]},children:[{type:a,value:V}]},{type:a,value:al},{type:b,tag:c,props:{className:[g]},children:[{type:a,value:am}]},{type:a,value:N},{type:b,tag:c,props:{className:[g]},children:[{type:a,value:aG}]},{type:a,value:bz},{type:b,tag:c,props:{className:[k]},children:[{type:a,value:"birthtime"}]},{type:a,value:h},{type:b,tag:c,props:{className:[g]},children:[{type:a,value:W}]},{type:a,value:ak},{type:b,tag:c,props:{className:[g]},children:[{type:a,value:V}]},{type:a,value:al},{type:b,tag:c,props:{className:[g]},children:[{type:a,value:am}]},{type:a,value:N},{type:b,tag:c,props:{className:[g]},children:[{type:a,value:aG}]},{type:a,value:"633Z\n        }\n    }\n]\n"}]}]}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"今まで"},{type:b,tag:d,props:{},children:[{type:a,value:"fs.readDir"}]},{type:a,value:"と"},{type:b,tag:d,props:{},children:[{type:a,value:"fs.stat"}]},{type:a,value:"を用いて膨大な処理を書いていたのでお手軽さに驚き。積極的に使っていきたい。"}]}]},text:"\nあるディレクトリ配下に存在する全てのファイルに対しアクションを行いたい場合、[klaw](https:\u002F\u002Fgithub.com\u002Fjprichardson\u002Fnode-klaw)や[klaw-sync](https:\u002F\u002Fgithub.com\u002Fmanidlou\u002Fnode-klaw-sync)が便利だと知ったのでメモ。\n\n元々は、`fs`の拡張である[`fs-extra`](https:\u002F\u002Fgithub.com\u002Fjprichardson\u002Fnode-fs-extra)の内に含まれていた`walk`が同じ役割を果たしていたようだが、\n\n\u003EWhat happened to `walk()` and `walkSync()`?  \n\u003EThey were removed from `fs-extra` in v2.0.0. If you need the functionality, `walk` and walkSync are available as separate packages, [`klaw`](https:\u002F\u002Fgithub.com\u002Fjprichardson\u002Fnode-klaw) and [`klaw-sync`](https:\u002F\u002Fgithub.com\u002Fmanidlou\u002Fnode-klaw-sync).\n\n引用：[fs-extra - npm](https:\u002F\u002Fwww.npmjs.com\u002Fpackage\u002Ffs-extra#what-happened-to-walk-and-walksync-)\n\nとのことで、現在は個別にインストールする必要がある。\n\n```javascript\nconst klawSync = require('klaw-sync');\nlet filelist = [];\n\ntry {\n    filelist = klawSync('\u002Ffoo\u002Fbar', {\n        nodir: true \u002F\u002F nodirを有効にすることでファイル名のみを出力\n    });\n} catch (err) {\n    console.error(err);\n}\n```\n\n`dirent`の形式でファイルリストが出力される。\n\n```javascript\n[\n    {\n        path: '\u002Ffoo\u002Fbar\u002Fxxx.js',\n        stats: Stats {\n            dev: 16777221,\n            mode: 33188,\n            nlink: 1,\n            uid: 502,\n            gid: 20,\n            rdev: 0,\n            blksize: 4096,\n            ino: 725582,\n            size: 5523,\n            blocks: 16,\n            atimeMs: 1589185938547.9219,\n            mtimeMs: 1589185934632.984,\n            ctimeMs: 1589185934632.984,\n            birthtimeMs: 1589185934632.7583,\n            atime: 2020-05-11T08:32:18.548Z,\n            mtime: 2020-05-11T08:32:14.633Z,\n            ctime: 2020-05-11T08:32:14.633Z,\n            birthtime: 2020-05-11T08:32:14.633Z\n        }\n    }\n]\n```\n\n今まで`fs.readDir`と`fs.stat`を用いて膨大な処理を書いていたのでお手軽さに驚き。積極的に使っていきたい。\n",dir:P,path:"\u002Farticle\u002F20200515",extension:Q,createdAt:L,updatedAt:L}]}],fetch:[],mutations:void 0}}("text","element","span","code","\n","p","hljs-number",": ","br","a","hljs-attr","hljs-string","hljs-keyword","div",",\n            ","nofollow","noopener","noreferrer","_blank","nuxt-content-highlight","pre","hljs","value","left"," ","\u003Cinput type=\"file\"\u003E","true","hljs-attribute","td",2,"参考","h2",-1,"icon","icon-link","javascript","hljs-comment","2020-12-24T12:42:38.374Z","root",":","li","\u002Farticle",".md","const","hljs-tag","hljs-name","\u003E","05","2020","2020-12-24T12:42:38.375Z","\u003Cbutton\u003E","JavaScript","まとめ","files","\n    ","hljs-built_in",");\n","(","\u003Cform\u003E","tr","パラメータの追加","その他","new",", ","-","-11T08:","32","の","null","File","0","1","ul","hljs-function","hljs-params","item",") =\u003E","\u003C","button","詳しく見る","\u003C\u002F","type=\"button\"","th","や","?",") ","14.","HTML","1-input-typefileのvalueは、画像データではない","2-input-typefileで取得した画像データは、置き換えできない","\u003Cinput\u003E","hljs-symbol","ではなく","FileList","16","02","size","type","set","property","#%E5%8F%82%E8%80%83"," wrap = ","document",".querySelector(","'.wrap'"," items = wrap.querySelectorAll(","'.item'"," {\n  wrap.appendChild(item); ","\u002F\u002F Error","\n});\n","html","submit","。","何もしない。","blockquote","=","href","\u003Cdiv\u003E","\u003Ca\u003E","urlの取得","URLの取得"," URL(location.href);\n","searchParams","'name'","'test'","https:\u002F\u002Fgithub.com\u002Fjprichardson\u002Fnode-klaw","klaw","https:\u002F\u002Fgithub.com\u002Fmanidlou\u002Fnode-klaw-sync","klaw-sync","fs-extra","walk"," and ","1589185934632.984","633Z,\n            ")));
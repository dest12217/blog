__NUXT_JSONP__("/20201225", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W){return {data:[{article:{slug:"20201225",title:"\u003Cinput type=\"file\"\u003EをJavaScriptで扱うときに気をつけること",timestamp:"2020\u002F12\u002F25",tags:["JavaScript","HTML"],toc:[{id:L,depth:p,text:"1. \u003Cinput type=\"file\"\u003Eのvalueは、画像データではない"},{id:M,depth:p,text:"2. \u003Cinput type=\"file\"\u003Eで取得した画像データは、置き換えできない"},{id:q,depth:p,text:q},{id:r,depth:p,text:r}],body:{type:"root",children:[{type:b,tag:f,props:{},children:[{type:a,value:"この記事は"},{type:b,tag:m,props:{href:"https:\u002F\u002Fqiita.com\u002Fadvent-calendar\u002F2020\u002Fjavascript",rel:[A,B,C],target:D},children:[{type:a,value:"JavaScript Advent Calendar 2020"}]},{type:a,value:"の25日目になります。"}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"レビューサイトを始めとする「ユーザーが画像ファイルをそれぞれがアップロードして投稿するウェブサイト」を作るとき、必ず用いられるのが"},{type:b,tag:d,props:{},children:[{type:a,value:j}]},{type:a,value:"によるアップロードです。"}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"一般的にファイルのアップロードといえば、PHPやSQLといったバックエンド技術が主役のように捉えられがちです。"},{type:b,tag:h,props:{},children:[]},{type:a,value:"\nしかし、取得した画像ファイルを用いたサムネイルの生成や画像ファイルの軽量化など、JavaScriptの出番も少なくありません。 "}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"実際に"},{type:b,tag:d,props:{},children:[{type:a,value:j}]},{type:a,value:"を取り扱い、いくつかハマりやすいと感じたポイントがあったため、この場を借りてまとめていきます。"}]},{type:a,value:e},{type:b,tag:s,props:{id:L},children:[{type:b,tag:m,props:{href:"#1-input-typefile%E3%81%AEvalue%E3%81%AF%E3%80%81%E7%94%BB%E5%83%8F%E3%83%87%E3%83%BC%E3%82%BF%E3%81%A7%E3%81%AF%E3%81%AA%E3%81%84",ariaHidden:t,tabIndex:u},children:[{type:b,tag:c,props:{className:[v,w]},children:[]}]},{type:a,value:"1. "},{type:b,tag:d,props:{},children:[{type:a,value:j}]},{type:a,value:E},{type:b,tag:d,props:{},children:[{type:a,value:g}]},{type:a,value:"は、画像データではない"}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:b,tag:d,props:{},children:[{type:a,value:"\u003Cinput\u003E"}]},{type:a,value:"要素は、入力されたテキストをステータスを"},{type:b,tag:d,props:{},children:[{type:a,value:g}]},{type:a,value:"の中に格納し、保持します。"},{type:b,tag:h,props:{},children:[]},{type:a,value:e},{type:b,tag:d,props:{},children:[{type:a,value:j}]},{type:a,value:"を例外ではなく、"},{type:b,tag:d,props:{},children:[{type:a,value:g}]},{type:a,value:"で値を受け取り、"},{type:b,tag:d,props:{},children:[{type:a,value:g}]},{type:a,value:"を空にすることでデータを削除することができます。\nしかし、その"},{type:b,tag:d,props:{},children:[{type:a,value:g}]},{type:a,value:"内部を"},{type:b,tag:d,props:{},children:[{type:a,value:"console.log"}]},{type:a,value:"で確認すると、値は画像データではありませんでした。"}]},{type:a,value:e},{type:b,tag:F,props:{className:[G]},children:[{type:b,tag:H,props:{},children:[{type:b,tag:d,props:{className:[I,J]},children:[{type:a,value:"C:"},{type:b,tag:c,props:{className:[N]},children:[{type:a,value:"\\f"}]},{type:a,value:"akepath"},{type:b,tag:c,props:{className:[N]},children:[{type:a,value:"\\i"}]},{type:a,value:"mage.jpg\n"}]}]}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:b,tag:d,props:{},children:[{type:a,value:j}]},{type:a,value:E},{type:b,tag:d,props:{},children:[{type:a,value:g}]},{type:a,value:"に保存されるのは、画像のデータではなくパスです。"},{type:b,tag:h,props:{},children:[]},{type:a,value:"\n取得した画像データは"},{type:b,tag:d,props:{},children:[{type:a,value:g}]},{type:a,value:"ではなく、"},{type:b,tag:d,props:{},children:[{type:a,value:x}]},{type:a,value:"の中に配列で格納されます。"},{type:b,tag:h,props:{},children:[]},{type:a,value:"\n画像のプレビューなど、取得した画像をページ上に再描写させる機能を実装する際には、"},{type:b,tag:d,props:{},children:[{type:a,value:g}]},{type:a,value:O},{type:b,tag:d,props:{},children:[{type:a,value:x}]},{type:a,value:"のデータを用いることになります。"}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"また、"},{type:b,tag:d,props:{},children:[{type:a,value:j}]},{type:a,value:E},{type:b,tag:d,props:{},children:[{type:a,value:g}]},{type:a,value:"にはアクセス制約あるため、取得した画像ファイルのフルパスは取得できません。"},{type:b,tag:h,props:{},children:[]},{type:a,value:"\n各ブラウザによって取得されるパスの形式は異なりますが、大体の場合「C:\u002Ffakepath\u002F」などのダミーパスが表示されます。"},{type:b,tag:h,props:{},children:[]},{type:a,value:"\nもし、ファイル名をページ上に表示させる画面を作りたいのであれば、ファイル名の取得には、"},{type:b,tag:d,props:{},children:[{type:a,value:g}]},{type:a,value:O},{type:b,tag:d,props:{},children:[{type:a,value:"files[i].name"}]},{type:a,value:"を用いたほうがよいでしょう。"}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"同じくセキュリティの観点から、"},{type:b,tag:d,props:{},children:[{type:a,value:g}]},{type:a,value:"そのものを修正することも禁止されています。"}]},{type:a,value:e},{type:b,tag:s,props:{id:M},children:[{type:b,tag:m,props:{href:"#2-input-typefile%E3%81%A7%E5%8F%96%E5%BE%97%E3%81%97%E3%81%9F%E7%94%BB%E5%83%8F%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AF%E3%80%81%E7%BD%AE%E3%81%8D%E6%8F%9B%E3%81%88%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84",ariaHidden:t,tabIndex:u},children:[{type:b,tag:c,props:{className:[v,w]},children:[]}]},{type:a,value:"2. "},{type:b,tag:d,props:{},children:[{type:a,value:j}]},{type:a,value:"で取得した画像データは、置き換えできない"}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:b,tag:d,props:{},children:[{type:a,value:x}]},{type:a,value:"には"},{type:b,tag:d,props:{},children:[{type:a,value:K}]},{type:a,value:"コンストラクタが"},{type:b,tag:d,props:{},children:[{type:a,value:P}]},{type:a,value:"という名の配列になって格納されています。 "}]},{type:a,value:e},{type:b,tag:F,props:{className:[G]},children:[{type:b,tag:H,props:{},children:[{type:b,tag:d,props:{className:[I,J]},children:[{type:b,tag:c,props:{className:[k]},children:[{type:a,value:P}]},{type:a,value:" {"},{type:b,tag:c,props:{className:[i]},children:[{type:a,value:Q}]},{type:a,value:": File, length: "},{type:b,tag:c,props:{className:[i]},children:[{type:a,value:R}]},{type:a,value:"}\n  "},{type:b,tag:c,props:{className:[k]},children:[{type:a,value:Q}]},{type:a,value:": File\n    "},{type:b,tag:c,props:{className:[k]},children:[{type:a,value:"lastModified"}]},{type:a,value:n},{type:b,tag:c,props:{className:[i]},children:[{type:a,value:"1607151722901"}]},{type:a,value:y},{type:b,tag:c,props:{className:[k]},children:[{type:a,value:"lastModifiedDate"}]},{type:a,value:": Sat Dec "},{type:b,tag:c,props:{className:[i]},children:[{type:a,value:"05"}]},{type:a,value:o},{type:b,tag:c,props:{className:[i]},children:[{type:a,value:"2020"}]},{type:a,value:o},{type:b,tag:c,props:{className:[i]},children:[{type:a,value:"16"}]},{type:a,value:S},{type:b,tag:c,props:{className:[i]},children:[{type:a,value:T}]},{type:a,value:S},{type:b,tag:c,props:{className:[i]},children:[{type:a,value:T}]},{type:a,value:" GMT+"},{type:b,tag:c,props:{className:[i]},children:[{type:a,value:"0900"}]},{type:a,value:" (日本標準時) {}\n    "},{type:b,tag:c,props:{className:[k]},children:[{type:a,value:"name"}]},{type:a,value:n},{type:b,tag:c,props:{className:[z]},children:[{type:a,value:"\"image.jpg\""}]},{type:a,value:y},{type:b,tag:c,props:{className:[k]},children:[{type:a,value:"size"}]},{type:a,value:n},{type:b,tag:c,props:{className:[i]},children:[{type:a,value:"145455"}]},{type:a,value:y},{type:b,tag:c,props:{className:[k]},children:[{type:a,value:"type"}]},{type:a,value:n},{type:b,tag:c,props:{className:[z]},children:[{type:a,value:"\"image\u002Fjpeg\""}]},{type:a,value:y},{type:b,tag:c,props:{className:[k]},children:[{type:a,value:"webkitRelativePath"}]},{type:a,value:n},{type:b,tag:c,props:{className:[z]},children:[{type:a,value:"\"\""}]},{type:a,value:"\n  "},{type:b,tag:c,props:{className:[k]},children:[{type:a,value:"length"}]},{type:a,value:n},{type:b,tag:c,props:{className:[i]},children:[{type:a,value:R}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:b,tag:d,props:{},children:[{type:a,value:K}]},{type:a,value:"は、"},{type:b,tag:d,props:{},children:[{type:a,value:"new File()"}]},{type:a,value:"とすることで生成できるため、一見上書きが可能なように見えます。"},{type:b,tag:h,props:{},children:[]},{type:a,value:"\nしかし、実際に"},{type:b,tag:d,props:{},children:[{type:a,value:x}]},{type:a,value:"を故意に"},{type:b,tag:d,props:{},children:[{type:a,value:K}]},{type:a,value:"で上書きしようとすると失敗します。"}]},{type:a,value:e},{type:b,tag:F,props:{className:[G]},children:[{type:b,tag:H,props:{},children:[{type:b,tag:d,props:{className:[I,J]},children:[{type:a,value:"Uncaught TypeError: Failed "},{type:b,tag:c,props:{className:[l]},children:[{type:a,value:"to"}]},{type:a,value:o},{type:b,tag:c,props:{className:[l]},children:[{type:a,value:"set"}]},{type:a,value:" an indexed "},{type:b,tag:c,props:{className:[l]},children:[{type:a,value:U}]},{type:a,value:o},{type:b,tag:c,props:{className:[l]},children:[{type:a,value:"on"}]},{type:a,value:o},{type:b,tag:c,props:{className:[z]},children:[{type:a,value:"'FileList'"}]},{type:a,value:n},{type:b,tag:c,props:{className:[l]},children:[{type:a,value:"Index"}]},{type:a,value:o},{type:b,tag:c,props:{className:[l]},children:[{type:a,value:U}]},{type:a,value:" setter "},{type:b,tag:c,props:{className:[l]},children:[{type:a,value:"is"}]},{type:a,value:o},{type:b,tag:c,props:{className:[l]},children:[{type:a,value:"not"}]},{type:a,value:" supported.\n"}]}]}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"これも、"},{type:b,tag:d,props:{},children:[{type:a,value:j}]},{type:a,value:"のセキュリティが原因です。"}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"画像圧縮などでどうしてもデータを更新したいときには、画像をbase64に変換し、"},{type:b,tag:d,props:{},children:[{type:a,value:"\u003Cinput type=\"hidden\"\u003E"}]},{type:a,value:"など別のパーツにデータを保持させれば解決できます。"},{type:b,tag:h,props:{},children:[]},{type:a,value:e},{type:b,tag:d,props:{},children:[{type:a,value:j}]},{type:a,value:"に残っている元の画像データは、送信されないように削除しておくことを忘れずに。"}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"また、データが挿入できるということは、改竄もできるということです。"},{type:b,tag:h,props:{},children:[]},{type:a,value:e},{type:b,tag:d,props:{},children:[{type:a,value:g}]},{type:a,value:"の中身が改竄されたり、意図していないデータが送信されるリスクも存在します。"},{type:b,tag:h,props:{},children:[]},{type:a,value:"\nそのため、バックエンド側でのバリデーションや送信できるデータのサイズ制限は必須となります。"}]},{type:a,value:e},{type:b,tag:s,props:{id:q},children:[{type:b,tag:m,props:{href:"#%E3%81%BE%E3%81%A8%E3%82%81",ariaHidden:t,tabIndex:u},children:[{type:b,tag:c,props:{className:[v,w]},children:[]}]},{type:a,value:q}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"個人的に、フォーム関連パーツのHTMLとJavaScriptはなかなか融通が聞かない印象です。"},{type:b,tag:h,props:{},children:[]},{type:a,value:"\n難問にぶつかったとき、それを無理やり解決するのではなく、仕様をしっかり読み解いていくことを意識していきたいですね。"}]},{type:a,value:e},{type:b,tag:s,props:{id:r},children:[{type:b,tag:m,props:{href:"#%E5%8F%82%E8%80%83",ariaHidden:t,tabIndex:u},children:[{type:b,tag:c,props:{className:[v,w]},children:[]}]},{type:a,value:r}]},{type:a,value:e},{type:b,tag:"ul",props:{},children:[{type:a,value:e},{type:b,tag:V,props:{},children:[{type:b,tag:m,props:{href:"https:\u002F\u002Fdeveloper.mozilla.org\u002Fja\u002Fdocs\u002FWeb\u002FAPI\u002FFile\u002FFile",rel:[A,B,C],target:D},children:[{type:a,value:"File.File() - Web API | MDN"}]}]},{type:a,value:e},{type:b,tag:V,props:{},children:[{type:b,tag:m,props:{href:"https:\u002F\u002Fdeveloper.mozilla.org\u002Fja\u002Fdocs\u002FWeb\u002FHTML\u002FElement\u002Finput\u002Ffile",rel:[A,B,C],target:D},children:[{type:a,value:"\u003Cinput type=\"file\"\u003E - HTML: HyperText Markup Language | MDN"}]}]},{type:a,value:e}]}]},dir:"\u002Farticle",path:"\u002Farticle\u002F20201225",extension:".md",createdAt:W,updatedAt:W}}],fetch:[],mutations:void 0}}("text","element","span","code","\n","p","value","br","hljs-number","\u003Cinput type=\"file\"\u003E","hljs-attribute","hljs-keyword","a",": "," ",2,"まとめ","参考","h2","true",-1,"icon","icon-link","files","\n    ","hljs-string","nofollow","noopener","noreferrer","_blank","の","div","nuxt-content-highlight","pre","hljs","null","File","1-input-typefileのvalueは、画像データではない","2-input-typefileで取得した画像データは、置き換えできない","hljs-symbol","ではなく","FileList","0","1",":","02","property","li","2020-12-24T12:42:38.375Z")));